window.pga.observers.taskObserver={taskboardWatchIntervalId:null,storeId:"",normalizeTaskBoard:function(t){try{var e=t[this.storeId];if(!e)return null;let l=window.pga.store?.pixelsGame?.items||{};var r=new Date(e.nextReset).toISOString(),a=e.orders.map(e=>{let t={};e.request?t=e.request:e.requestItems&&0<e.requestItems.length&&(t=e.requestItems[0]);var r=t?.itemId||"",{currency:a,skill:s}=e.reward;return e.completedAt?{requiredSkill:null,reward:null,taskItem:null,playerClassId:e.playerClassId,taskAssignedAt:new Date(e.completedAt+e.cooldown).toISOString()}:{requiredSkill:{type:s.skillType,level:s.xp},reward:{type:"cur_coins"===a.currencyId?"coin":"pixel",quantity:a.amount},taskItem:{id:r,name:l[r]?.name||"",quantity:t?.quantity||0,icon:l[r]?.image||"",tier:l[r]?.tier||0},playerClassId:e.playerClassId,taskAssignedAt:null}}),[s]=a.filter(e=>e.deliveredAt);return{resetAt:r,deliveredItem:s,items:a}}catch(e){return console.log("normalizeTaskBoard",e,t),this.logError("normalizeTaskBoard",e,t),null}},processTaskBoard:function(t){try{var e=this.normalizeTaskBoard(t);if(!e)return null;var{resetAt:r,items:a}=e,s={resetAt:r,items:a,playerLevels:window.pga.helpers.getPlayerLevels()||null,trustScore:window.pga.helpers.getPlayerTrustScore()||null};window.pga.store.taskBoard=s,window.pga.helpers.notifyOrderTasksUpdate({...s,timestamp:(new Date).getTime()})}catch(e){console.log("processTaskBoard",e,t),this.logError("processTaskBoard",e,t)}},clearTaskboardWatchInterval:function(){this.taskboardWatchIntervalId&&(clearInterval(this.taskboardWatchIntervalId),this.taskboardWatchIntervalId=null)},watchTaskboardClosed:function(t){this.clearTaskboardWatchInterval(),this.taskboardWatchIntervalId=setInterval(()=>{var e=window.pga.helpers.getReduxValue()?.generalStore;e&&e?.storeId===this.storeId&&(e?.storeId!==this.storeId||e?.isOpen)||(this.clearTaskboardWatchInterval(),t())},500)},observeEvent:function(e,t){"sellOrders"===e?this.processTaskBoard(t):"presentUI"!==e||"str_taskBoard_01"!==t.ui&&"str_tutorial"!==t.ui||(this.storeId=t.ui,window.pga.helpers.notifyOrderTasksVisibleStateChanged(!0),this.watchTaskboardClosed(()=>{window.pga.helpers.notifyOrderTasksVisibleStateChanged(!1)}))},logError:async function(e,t,r){try{var a=window.pga.helpers.getPlayerId?.(),s={name:t?.name,message:t?.message||t?.body?.message||"",extra:r};await fetch("https://api-pixels.guildpal.com/market-api/v2/errlog",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({player_id:a,category:e,err_message:JSON.stringify(s)})})}catch(e){console.log("logError",e)}}};